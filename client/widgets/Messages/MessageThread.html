<template name="MessageThread">
    {{> Message this}}
    {{#each responsesOfSign this}}
        {{> Message this}}
    {{/each}}
</template>

<template name="SingleMessageThread">
    <div class="message-thread-header">
        <div class="google-maps-background">{{> googleMap type="Map" name="BackgroundMap" options=mapOptions}}</div>
        {{> Message this}}
    </div>
    {{#if topAvailableDiscussionId this}}
        <div class="message-thread-link-to-discussion-head">
            <a href="/discussion/sign/{{topAvailableDiscussionId this}}">
                See whole discussion
            </a>
        </div>
    {{/if}}
    {{#each responsesOfSign this}}
        {{> Message this}}
    {{/each}}
</template>

<template name="Message">
    <article class="messages-message {{isDeletedClass this}}">
        <header>
            <div class="messages-message-head">
                {{#if avatar}}
                    <img class="messages-message-avatar-pic" src="/static/resource/{{avatar}}" width="80" height="80">
                {{/if}}
                {{#if poster_id}}
                    <a class="messages-message-username" href="/{{username}}">{{username}}</a>
                {{/if}}
                {{#unless poster_id}}
                    <span class="messages-message-username">{{username}}</span>
                {{/unless}}
            </div>
        </header>
        <div class="messages-message-body">
        {{#if this.is_deleted}}
            Deleted
        {{/if}}
        {{#unless this.is_deleted}}
            {{FormatMessage this}}
        {{/unless}}
        </div>
        <div class="messages-message-attached-content">
            {{#unless this.is_deleted}}
                {{#if ownsAttachedContent this}}
                    <hr>
                {{/if}}
                {{attachedContent this}}
            {{/unless}}
        </div>
        <footer>
            <div class="messages-message-actions">
                <button class="js-show-response-form messages-messages-actions-reply"><i
                        class="fa fa-reply"></i> Reply</button>
                {{#if belongsToCurrentUser this}}
                    {{#unless this.is_deleted}}
                        <button class="js-delete-message messages-messages-actions-delete"><i class="fa fa-trash-o"></i></button>
                    {{/unless}}
                    {{#if this.is_deleted}}
                        <button class="js-undelete-message messages-messages-actions-undelete"><i class="fa fa-undo"></i></button>
                    {{/if}}
                {{/if}}
                {{#unless this.is_deleted}}
                     <a class="link-to-sign" title="share" href="/{{username}}/sign/{{_id}}"><i class="fa fa-link"></i></a>
                {{/unless}}
                {{#if this.is_deleted}}
                    <a class="link-to-sign" title="share" href=""><i class="fa fa-link"></i></a>
                {{/if}}
            </div>
            {{#if isRespondingTo this}}
                {{> NewMessageForm this}}
            {{/if}}
        </footer>
    </article>
</template>